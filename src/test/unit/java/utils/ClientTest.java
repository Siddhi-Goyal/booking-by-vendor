package utils;

import com.gap.sourcing.smee.dtos.responses.bamboorose.VendorResponse;
import com.gap.sourcing.smee.exceptions.ApiClientException;
import com.gap.sourcing.smee.utils.Client;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.web.reactive.function.client.ClientResponse;
import org.springframework.web.reactive.function.client.WebClient;
import reactor.core.publisher.Mono;

import static org.junit.jupiter.api.Assertions.assertEquals;


class ClientTest {

    private static final String VENDORAPI_URL ="https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045";
    private Client client;
    private WebClient webClient;
    private WebClient.Builder webClientBuilder;
    private ClientResponse clientResponse;

    @Test
    void get_Success_DenodoResponse() {
        clientResponse =ClientResponse.create(HttpStatus.OK).header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE).body(getSuccessResponsepayload()).build();
        webClientBuilder = WebClient.builder().exchangeFunction((request) -> Mono.just(clientResponse));
        webClient = webClientBuilder.defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE).build();
        client = new Client(webClientBuilder);
        VendorResponse response = client.get("", VendorResponse.class);
        assertEquals("ARVIND LIMITED",response.getResource().getLegalName());
        assertEquals(1, response.getResource().getVendorTiers().size());
    }

    @Test
    void get_DenodoResponse_throw_exception() {
        clientResponse =ClientResponse.create(HttpStatus.OK).header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE).body(getInvalidResponsePayload()).build();
        webClientBuilder = WebClient.builder().exchangeFunction((request) -> Mono.just(clientResponse));
        webClient = webClientBuilder.defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE).build();
        client = new Client(webClientBuilder);
        Assertions.assertThrows(ApiClientException.class, () -> client.get(VENDORAPI_URL, VendorResponse.class));
    }

    private String getSuccessResponsepayload(){
        return "{\"traceId\":\"1e80a742986a8f226198af89c3679bb7\",\"resource\":{\"owner\":\"GAP\",\"id\":\"1000045\",\"type\":\"MFG\",\"number\":\"000311194\",\"legalName\":\"ARVIND LIMITED\",\"partyAddress1\":null,\"partyAddress2\":null,\"partyCity\":null,\"partyCountry\":null,\"partyEmail\":null,\"partyWWWUrl\":null,\"aliasName\":\"THE ARVIND00045\",\"legalName2\":null,\"legalNameInLocalLanguage\":null,\"countryOfOrigin\":null,\"isExternalAgent\":null,\"hubId\":\"PARTY5\",\"primaryCurrency\":\"USD\",\"paymentType\":\"W\",\"paymentTerm\":\"N30\",\"classification\":\"VND\",\"bankAccountNo\":null,\"bankCode\":null,\"status\":\"A\",\"updatedBy\":\"SHAWNA\",\"updatedOn\":\"2022-05-16T19:33:29\",\"requestor\":\"RM ADMIN SVD INDIA IND\",\"region\":null,\"complianceAdministrator\":\"CA ADMIN\",\"relationshipManager\":null,\"activationRequestReceivedDate\":\"2006-04-11\",\"activationDate\":\"2006-04-11\",\"createdOn\":\"2022-04-27T17:23:28\",\"createdBy\":\"VRTEST3\",\"paymentMethod\":\"OA\",\"salesTerm\":\"FOB\",\"establishedYear\":null,\"secondaryCurrency\":null,\"isVeliSupported\":\"N\",\"isEdiSupported\":\"0\",\"numberOfEmployees\":0,\"approver\":null,\"approverTitle\":null,\"approvalDate\":null,\"segmentation\":\"\",\"usedByHubs\":null,\"weaknesses\":null,\"justification\":null,\"strengths\":null,\"comments\":null,\"addresses\":[{\"city\":\"BANGALORE\",\"state\":\"KA\",\"country\":\"IN\",\"type\":\"P\",\"typeDescription\":\"PHYSICAL\",\"addressLine1\":\"26/2 & 27/2 KENCHANAHALLI VILLAGE\",\"addressLine2\":\"KENGERI HOBLI\",\"addressLine3\":\"MYSORE ROAD\",\"postalCode\":\"560059\"},{\"city\":\"ALBUQUERQUE\",\"state\":\"NM\",\"country\":\"US\",\"type\":\"BILL\",\"typeDescription\":\"BILLING\",\"addressLine1\":\"ACCOUNTS PAYABLE\",\"addressLine2\":\"40 FIRST PLAZA,\",\"addressLine3\":\"ALBUQUERQUE, NM 87102\",\"postalCode\":\"87102\"}],\"isWorkerDormitory\":null,\"contacts\":[{\"typeDescription\":\"VENDOR SCORECARD\",\"www_url\":\"CHIEF-MARKETING & MERCHANDISIN\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":\"HI THIS IS A TEST\",\"extensionNumber\":null},\"firstName\":\"SUJAY\",\"middleName\":null,\"lastName\":\"MD\",\"emailAddress\":\"SUJAY.MD@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"VENDOR SCORECARD\"},{\"typeDescription\":\"VENDOR SCORECARD\",\"www_url\":\"SR. EXECUTIVE - MARKETING & ME\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"SIVA\",\"middleName\":null,\"lastName\":\"KUMAR\",\"emailAddress\":\"SIVAKUMAR.VM@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"VENDOR SCORECARD\"},{\"typeDescription\":\"VENDOR SCORECARD\",\"www_url\":\"COO - DENIM GARMENTS\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"RAJ\",\"middleName\":null,\"lastName\":\"KAPUR\",\"emailAddress\":\"RAJ.KAPUR@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"VENDOR SCORECARD\"},{\"typeDescription\":\"VENDOR SCORECARD\",\"www_url\":\"ASSOCIATE MANAGER\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"MALATHI\",\"middleName\":null,\"lastName\":\"G\",\"emailAddress\":\"MALATHI.G@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"VENDOR SCORECARD\"},{\"typeDescription\":\"VENDOR SCORECARD\",\"www_url\":\"HEAD - MARKETING & MERCHANDISI\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"KAUSHER\",\"middleName\":null,\"lastName\":\"FATHIMA\",\"emailAddress\":\"KAUSHER@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"VENDOR SCORECARD\"},{\"typeDescription\":\"OTHERS\",\"www_url\":\"HR OFFICER\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"SUDHINDRA\",\"middleName\":null,\"lastName\":\"KUMAR (MR)\",\"emailAddress\":\"SUDHINDRA.KUMAR@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"OTHERS\"},{\"typeDescription\":\"MERCHANDISING\",\"www_url\":\"COO - DENIM GARMENTS\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"RAJ\",\"middleName\":null,\"lastName\":\"KAPUR\",\"emailAddress\":\"RAJ.KAPUR@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"MERCHANDISING\"},{\"typeDescription\":\"MERCHANDISING\",\"www_url\":\"HEAD - MARKETING & MERCHANDISI\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"KAUSHER\",\"middleName\":null,\"lastName\":\"FATHIMA\",\"emailAddress\":\"KAUSHER@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"true\",\"jobTitle\":\"MERCHANDISING\"},{\"typeDescription\":\"LOGISTICS\",\"www_url\":null,\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"THIRUMALA\",\"middleName\":null,\"lastName\":\"KUMAR\",\"emailAddress\":\"THIRUMALA.KUMAR@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"LOGISTICS\"},{\"typeDescription\":\"EXECUTIVE/PRESIDENT\",\"www_url\":\"CEO - WOVEN & KNIT FABRICS\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"SUSHEEL\",\"middleName\":null,\"lastName\":\"KAUL\",\"emailAddress\":\"SUSHEEL.KAUL@ARVIND.IN\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"EXECUTIVE/PRESIDENT\"},{\"typeDescription\":\"EXECUTIVE/PRESIDENT\",\"www_url\":\"COO - DENIM GARMENTS\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"RAJ\",\"middleName\":null,\"lastName\":\"KAPUR\",\"emailAddress\":\"RAJ.KAPUR@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"EXECUTIVE/PRESIDENT\"},{\"typeDescription\":\"EXECUTIVE/PRESIDENT\",\"www_url\":\"EXECUTIVE DIRECTOR\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"PUNIT\",\"middleName\":null,\"lastName\":\"LALBHAI\",\"emailAddress\":\"PUNIT.LALBHAI@ARVIND.IN\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"EXECUTIVE/PRESIDENT\"},{\"typeDescription\":\"EXECUTIVE/PRESIDENT\",\"www_url\":\"VICE PRESIDENT - SALES & MARKE\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"KARAN\",\"middleName\":null,\"lastName\":\"OJHA\",\"emailAddress\":\"KARAN.OJHA@ARVIND.IN\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"EXECUTIVE/PRESIDENT\"},{\"typeDescription\":\"EXECUTIVE/PRESIDENT\",\"www_url\":\"CEO - APPAREL GROUP\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"ASHISH\",\"middleName\":null,\"lastName\":\"KUMAR\",\"emailAddress\":\"ASHISH.KUMAR@ARVINDEXPORTS.COM\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"EXECUTIVE/PRESIDENT\"},{\"typeDescription\":\"EXECUTIVE/PRESIDENT\",\"www_url\":\"CEO - DENIM FABRICS\",\"phone\":{\"internationalCountryCode\":null,\"areaCode\":null,\"number\":null,\"extensionNumber\":null},\"firstName\":\"AAMIR\",\"middleName\":null,\"lastName\":\"AKHTAR\",\"emailAddress\":\"AAMIR.AKHTAR@ARVIND.IN\",\"isPrimaryContact\":\"false\",\"jobTitle\":\"EXECUTIVE/PRESIDENT\"}],\"productSubCategories\":[],\"isComplianceMonitored\":null,\"technicalEvaluationRequestDate\":null,\"technicalEvaluationRating\":\"\",\"technicalProductSafetyResult\":null,\"workNumberRange\":null,\"workCategory\":\"\",\"factorySize\":null,\"typeDescription\":\"MANUFACTURER\",\"statusDescription\":\"ACTIVE\",\"classificationDescription\":\"VENDOR\",\"paymentTypeDescription\":\"WIRE TRANSFER\",\"paymentMethodDescription\":\"OPEN ACCOUNT\",\"paymentTermDescription\":\"NET 30\",\"salesTermDescription\":\"FREE ON BOARD\",\"factoryTiers\":[{\"relationshipSubType\":\"DEP\",\"factory\":{\"id\":\"2001905\",\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/2001905\"}}},\"vendor\":{\"id\":\"1000045\",\"affiliationStartDate\":\"2022-04-28T12:57:06\",\"parentVendor\":false,\"primaryVendor\":true,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"relationshipStatusDescription\":\"ACTIVE\",\"number\":\"200021690\",\"partyAffiliationTypeCode\":\"VND2FTRY\"},{\"relationshipSubType\":\"DEP\",\"factory\":{\"id\":\"2013130\",\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/2013130\"}}},\"vendor\":{\"id\":\"1000045\",\"affiliationStartDate\":\"2022-04-28T12:59:46\",\"parentVendor\":false,\"primaryVendor\":true,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"relationshipStatusDescription\":\"ACTIVE\",\"number\":\"200034100\",\"partyAffiliationTypeCode\":\"VND2FTRY\"},{\"relationshipSubType\":\"DEP\",\"factory\":{\"id\":\"2055169\",\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/2055169\"}}},\"vendor\":{\"id\":\"1000045\",\"affiliationStartDate\":\"2022-04-28T13:09:25\",\"parentVendor\":false,\"primaryVendor\":true,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"relationshipStatusDescription\":\"ACTIVE\",\"number\":\"200081779\",\"partyAffiliationTypeCode\":\"VND2FTRY\"},{\"relationshipSubType\":\"DEP\",\"factory\":{\"id\":\"2056635\",\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/2056635\"}}},\"vendor\":{\"id\":\"1000045\",\"affiliationStartDate\":\"2022-04-28T13:09:36\",\"parentVendor\":false,\"primaryVendor\":true,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"relationshipStatusDescription\":\"ACTIVE\",\"number\":\"200083075\",\"partyAffiliationTypeCode\":\"VND2FTRY\"},{\"relationshipSubType\":\"DEP\",\"factory\":{\"id\":\"1012582\",\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1012582\"}}},\"vendor\":{\"id\":\"1000045\",\"affiliationStartDate\":\"2022-04-28T12:41:40\",\"parentVendor\":false,\"primaryVendor\":true,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"relationshipStatusDescription\":\"ACTIVE\",\"number\":\"000911197\",\"partyAffiliationTypeCode\":\"VND2FTRY\"},{\"relationshipSubType\":\"DEP\",\"factory\":{\"id\":\"1018393\",\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1018393\"}}},\"vendor\":{\"id\":\"1000045\",\"affiliationStartDate\":\"2022-04-28T12:52:31\",\"parentVendor\":false,\"primaryVendor\":true,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"relationshipStatusDescription\":\"ACTIVE\",\"number\":\"200023778\",\"partyAffiliationTypeCode\":\"VND2FTRY\"}],\"vendorTiers\":[{\"id\":\"1002493\",\"relationshipStatusDescription\":\"ACTIVE\",\"relationshipSubType\":null,\"number\":\"000306899\",\"partyAffiliationTypeCode\":\"VND2VND\",\"parentVendor\":false,\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1002493\"}}}],\"_links\":{\"self\":{\"href\":\"https://stage.api.azeus.gaptech.com/sourcing/vendor-profile-integrator/parties/1000045\"}}},\"timestamp\":\"2022-05-17T13:08:47.578+00:00\"}";
    }

    private String getInvalidResponsePayload(){
        return "{\"httpStatus\":200,\"traceId\":\"1e80a742986a8f226198af89c3679bb7\",\"resource\":{\"id\":\"c9c2e5a9-f210-4e70-aee0-a05e0a5a891f\",\"deleted\":false,\"isCustomerChoiceActive\":true,\"bomCustomerChoice\":{\"bomCCNumber\":\"000002423722\"},\"customerChoice\":{\"number\":\"975498006\",\"comments\":null},\"se22Color\":{\"colorCode\":\"839\",\"colorAbbrDescription\":\"STMGNFDR\",\"colorLongDescription\":\"STEM GREEN FEEDER\"},\"finishedGoodColor\":null,\"colorComment\":null,\"comments\":null,\"productionComments\":null,\"realizeComments\":null}";
    }
}